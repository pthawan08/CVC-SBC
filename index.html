<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏û‡∏û‡∏ä.</title>
  
  <link rel="icon" href="logo.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
  
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body { font-family: 'Prompt', sans-serif; background-color: #f4f6f9; padding-bottom: 50px; }
    .nav-pills .nav-link.active { background-color: #2c3e50; }
    .nav-pills .nav-link { color: #2c3e50; }
    .card { border: none; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); margin-bottom: 20px; }
    .header-title { color: #2c3e50; font-weight: 600; }
    
    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏Å‡∏ï‡∏¥ */
    .check-btn { width: 100%; text-align: left; padding: 15px; margin-bottom: 10px; border: 1px solid #dee2e6; border-radius: 10px; background: white; transition: 0.2s; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
    .check-btn:hover { transform: translateY(-2px); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    
    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ï‡∏≠‡∏ô‡∏ï‡∏¥‡πä‡∏Å‡∏ñ‡∏π‡∏Å (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å) */
    .check-btn.checked { background-color: #d4edda; border-color: #c3e6cb; color: #155724; }
    .check-icon { font-size: 1.5rem; color: #ccc; }
    .check-btn.checked .check-icon { color: #28a745; }

    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß) */
    .check-btn.locked {
      background-color: #f8f9fa; /* ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡∏à‡∏≤‡∏á‡πÜ */
      border-color: #e9ecef;
      cursor: default; /* ‡πÄ‡∏°‡∏≤‡∏™‡πå‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ */
      opacity: 0.8;
    }
    .check-btn.locked:hover {
      transform: none; /* ‡πÑ‡∏°‡πà‡πÄ‡∏î‡πâ‡∏á */
      box-shadow: none;
    }
    .check-btn.locked .check-icon {
      color: #198754; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏Ç‡πâ‡∏° */
    }

    .status-text { font-size: 0.8rem; margin-top: 2px; }
    .badge-subject { font-size: 0.9rem; padding: 8px 12px; border-radius: 20px; font-weight: 500; }
    .loading { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.8); z-index:9999; justify-content:center; align-items:center; }
  </style>
</head>
<body>

  <div class="loading" id="loading">
    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;"></div>
  </div>

  <div class="container mt-4">
    <h2 class="text-center mb-4 header-title">
      <img src="logo.png" onerror="this.style.display='none'" style="height: 50px; margin-right: 10px;">
      ‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏û‡∏û‡∏ä.
    </h2>

    <ul class="nav nav-pills nav-fill mb-4 p-2 bg-white rounded shadow-sm" id="pills-tab" role="tablist">
      <li class="nav-item"><button class="nav-link active" data-bs-toggle="pill" data-bs-target="#tab-register">1. ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-checkin">2. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-dashboard" onclick="loadDashboard()">3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-stats" onclick="loadStats()">4. ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button></li>
    </ul>

    <div class="tab-content">
      
      <div class="tab-pane fade show active" id="tab-register">
        <div class="card p-4">
          <h4 class="mb-3">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
          <select class="form-select mb-3" id="reg-classname">
             <option value="" selected disabled>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô --</option>
             <option value="‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÉ‡∏´‡∏°‡πà">‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÉ‡∏´‡∏°‡πà</option>
             <option value="‡∏´‡∏•‡∏±‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏Ñ‡∏£‡∏¥‡∏™‡πÄ‡∏ï‡∏µ‡∏¢‡∏ô">‡∏´‡∏•‡∏±‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏Ñ‡∏£‡∏¥‡∏™‡πÄ‡∏ï‡∏µ‡∏¢‡∏ô</option>
             <option value="‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏Å‡∏©‡∏±‡∏ï‡∏£‡∏¥‡∏¢‡πå‡∏î‡∏≤‡∏ß‡∏¥‡∏î">‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏Å‡∏©‡∏±‡∏ï‡∏£‡∏¥‡∏¢‡πå‡∏î‡∏≤‡∏ß‡∏¥‡∏î</option>
             <option value="‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏ã‡∏•‡∏•‡πå">‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏ã‡∏•‡∏•‡πå</option>
          </select>
          <div id="studentList"></div>
          <button class="btn btn-outline-secondary w-100 mb-3" onclick="addStudentField()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</button>
          <button class="btn btn-primary w-100" onclick="submitRegistration()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>
        </div>
      </div>

      <div class="tab-pane fade" id="tab-checkin">
        <div class="card p-4">
          <div class="d-flex justify-content-between align-items-center mb-3">
             <h4 class="mb-0">‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
             <div>
                <button class="btn btn-sm btn-outline-danger me-1" onclick="clearAllChecks()"><i class="fas fa-undo me-1"></i>‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤</button>
                <button class="btn btn-sm btn-outline-primary" onclick="loadStudentList()"><i class="fas fa-sync-alt me-1"></i>‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
             </div>
          </div>

          <div class="alert alert-info border-0 shadow-sm"><i class="fas fa-clock me-2"></i>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞ <strong>‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</strong> ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</div>
          
          <div class="row g-2 mb-3 bg-light p-3 rounded">
            <div class="col-md-4"><label class="small text-muted">1. ‡∏ß‡∏¥‡∏ä‡∏≤</label><select class="form-select" id="checkin-class" onchange="loadStudentList()"><option value="" disabled selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤ --</option><option value="‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÉ‡∏´‡∏°‡πà">‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÉ‡∏´‡∏°‡πà</option><option value="‡∏´‡∏•‡∏±‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏Ñ‡∏£‡∏¥‡∏™‡πÄ‡∏ï‡∏µ‡∏¢‡∏ô">‡∏´‡∏•‡∏±‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏Ñ‡∏£‡∏¥‡∏™‡πÄ‡∏ï‡∏µ‡∏¢‡∏ô</option><option value="‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏Å‡∏©‡∏±‡∏ï‡∏£‡∏¥‡∏¢‡πå‡∏î‡∏≤‡∏ß‡∏¥‡∏î">‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏Å‡∏©‡∏±‡∏ï‡∏£‡∏¥‡∏¢‡πå‡∏î‡∏≤‡∏ß‡∏¥‡∏î</option><option value="‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏ã‡∏•‡∏•‡πå">‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏ã‡∏•‡∏•‡πå</option></select></div>
            <div class="col-md-4"><label class="small text-muted">2. ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà</label><select class="form-select" id="checkin-week" onchange="loadStudentList()"><script>for(let i=1; i<=12; i++) document.write(`<option value="${i}">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà ${i}</option>`);</script></select></div>
            <div class="col-md-4"><label class="small text-muted">3. ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input type="date" class="form-control" id="checkin-date"></div>
          </div>

          <div class="mb-3 position-relative">
             <i class="fas fa-search position-absolute text-muted" style="top: 12px; left: 15px;"></i>
             <input type="text" id="student-search" class="form-control ps-5 rounded-pill" placeholder="üîç ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." onkeyup="filterStudents()">
          </div>

          <div id="checkin-list-area"><div class="text-center text-muted py-5">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</div></div>
          
          <div id="submit-zone" class="d-none mt-4 p-3 border-top position-sticky bottom-0 bg-white shadow-lg rounded">
            <button class="btn btn-success w-100 btn-lg shadow-sm" onclick="submitCheckIn()">
               <i class="fas fa-save me-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠
            </button>
          </div>
        </div>
      </div>

      <div class="tab-pane fade" id="tab-dashboard">
        <div class="card p-4">
          <h4 class="mb-3">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
          <div class="table-responsive">
            <table id="dashboardTable" class="table table-hover align-middle" style="width:100%">
              <thead
